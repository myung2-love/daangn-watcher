<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>당근마켓 스캔</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
    body { 
        background-color: #FFF7ED; 
        font-family: 'Nanum Gothic', 'Roboto', sans-serif;
    }
    .keyword-chip { 
        background: linear-gradient(90deg, #FB923C, #F97316);
        color: white; 
        padding: 0.3rem 0.6rem; 
        border-radius: 9999px; 
        margin: 0.25rem; 
        display: inline-block;
        font-weight: 500;
        cursor: pointer;
        transition: transform 0.2s;
    }
    .keyword-chip:hover { transform: scale(1.05); }
</style>
</head>

<body class="min-h-screen p-8 flex justify-center items-start">
<div class="w-full max-w-2xl bg-white rounded-2xl shadow-xl p-8 animate-fadeIn">
    <h1 class="text-4xl font-bold text-orange-500 mb-8 text-center">당근마켓 스캔</h1>

    <div class="mb-6">
        <label class="block text-gray-700 font-semibold mb-2">시/도 선택</label>
        <div class="relative">
            <select id="city-select" 
                class="w-full border border-gray-300 rounded-xl px-4 pr-10 py-3 leading-tight 
                       focus:outline-none focus:ring-2 focus:ring-orange-400 appearance-none">
                <option value="">선택</option>
                {% for city in locations.keys() %}
                    <option value="{{ city }}">{{ city }}</option>
                {% endfor %}
            </select>
            <!-- 커스텀 꺽쇠 아이콘 -->
            <div class="absolute inset-y-0 right-3 flex items-center pointer-events-none">
                <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" stroke-width="2" 
                     viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
                </svg>
            </div>
        </div>
    </div>

    <div class="mb-6">
        <label class="block text-gray-700 font-semibold mb-2">검색 키워드</label>
        <div class="flex shadow-sm rounded-xl overflow-hidden border border-gray-300">
            <input type="text" id="keyword-input" placeholder="키워드 입력" class="flex-1 px-4 py-3 focus:outline-none">
            <button type="button" onclick="addKeyword()" class="bg-gradient-to-r from-orange-400 to-orange-500 hover:from-orange-500 hover:to-orange-600 transition text-white px-5 font-semibold">추가</button>
        </div>
        <div id="keywords-list" class="mt-3 flex flex-wrap"></div>
    </div>

    <div class="mb-6">
        <label class="block text-gray-700 font-semibold mb-2">조회 기간 (일)</label>
        <input type="number" id="days-input" value="1" min="1" class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-orange-400">
    </div>

    <form id="scan-form" method="post" action="/submit">
        <input type="hidden" name="keywords" id="keywords-hidden">
        <input type="hidden" name="city" id="city-hidden">
        <input type="hidden" name="days" id="days-hidden">
        <button type="submit" class="w-full py-3 mt-4 bg-gradient-to-r from-orange-400 to-orange-500 hover:from-orange-500 hover:to-orange-600 text-white font-bold rounded-2xl shadow-lg transition transform hover:scale-105">스캔 실행</button>
    </form>
</div>

<script>
    let keywords = [];

    function addKeyword() {
        const input = document.getElementById("keyword-input");
        const val = input.value.trim();
        if (val && !keywords.includes(val)) {
            keywords.push(val);
            renderKeywords();
        }
        input.value = "";
        input.focus(); // 입력 후 다시 포커스 유지
    }

    function renderKeywords() {
        const container = document.getElementById("keywords-list");
        container.innerHTML = "";
        keywords.forEach(k => {
            const chip = document.createElement("span");
            chip.className = "keyword-chip flex items-center space-x-1";
            
            const text = document.createElement("span");
            text.textContent = k;

            const close = document.createElement("button");
            close.innerHTML = "&times;";
            close.className = "ml-2 text-white font-bold focus:outline-none";
            close.onclick = () => removeKeyword(k);

            chip.appendChild(text);
            chip.appendChild(close);
            container.appendChild(chip);
        });
    }

    function removeKeyword(k) {
        keywords = keywords.filter(kw => kw !== k);
        renderKeywords();
    }

    document.getElementById("keyword-input").addEventListener("keydown", function(e) {
        if (e.key === "Enter") {
            e.preventDefault(); // 폼 전송 방지
            addKeyword();
        }
    });

    document.getElementById("scan-form").addEventListener("submit", function(e) {
        document.getElementById("keywords-hidden").value = keywords.join(",");
        document.getElementById("city-hidden").value = document.getElementById("city-select").value;
        document.getElementById("days-hidden").value = document.getElementById("days-input").value;
        keywords = []; 
        renderKeywords();
    });
</script>
</body>
</html>

